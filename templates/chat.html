{% extends "base.html" %}

{% block extra_css %}
<style>
.chat-container {
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 1rem;
}

.messages {
    flex-grow: 1;
    overflow-y: auto;
    margin-bottom: 1rem;
    padding: 1rem;
    background: var(--bs-dark);
    border-radius: 0.5rem;
}

.message {
    margin-bottom: 1rem;
    padding: 0.5rem;
    border-radius: 0.25rem;
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    color: var(--bs-secondary);
}

.message-content {
    background: var(--bs-secondary-bg);
    padding: 0.5rem;
    border-radius: 0.25rem;
    word-break: break-word;
}

.message-form {
    display: flex;
    gap: 1rem;
}

.message-input {
    flex-grow: 1;
}
</style>
{% endblock %}

{% block content %}
<div class="chat-container">
    <div class="messages" id="messages">
        {% for message in messages %}
        <div class="message">
            <div class="message-header">
                <span>{{ message.sender.username }}</span>
                <span>{{ message.timestamp.strftime('%H:%M') }}</span>
            </div>
            <div class="message-content">
                {{ message.content }}
            </div>
        </div>
        {% endfor %}
    </div>
    
    <form class="message-form" id="message-form">
        <input type="text" class="form-control message-input" id="message-input" placeholder="Type your message..." required>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
const socket = io();
const messagesDiv = document.getElementById('messages');
const messageForm = document.getElementById('message-form');
const messageInput = document.getElementById('message-input');

messageForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = messageInput.value.trim();
    if (message) {
        socket.emit('send_message', { message: message });
        messageInput.value = '';
    }
});

socket.on('new_message', (data) => {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message';
    messageDiv.innerHTML = `
        <div class="message-header">
            <span>${data.username}</span>
            <span>${data.timestamp}</span>
        </div>
        <div class="message-content">
            ${data.message}
        </div>
    `;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

// Auto-scroll to bottom on page load
messagesDiv.scrollTop = messagesDiv.scrollHeight;
</script>
{% endblock %}
