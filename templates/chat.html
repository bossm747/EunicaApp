{% extends "base.html" %}

{% block content %}
<div class="chat-container">
    <div class="messages" id="messages">
        {% for message in messages %}
        <div class="message">
            <div class="message-header">
                <span>{{ message.sender.username }}</span>
                <span>{{ message.timestamp.strftime('%H:%M') }}</span>
            </div>
            <div class="message-content">
                {{ message.content }}
            </div>
        </div>
        {% endfor %}
    </div>
    
    <form class="message-form" id="message-form">
        <input type="text" class="form-control message-input" id="message-input" placeholder="Type your message..." required>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>
</div>

<script>
const socket = io();
const messagesDiv = document.getElementById('messages');
const messageForm = document.getElementById('message-form');
const messageInput = document.getElementById('message-input');

messageForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = messageInput.value.trim();
    if (message) {
        socket.emit('send_message', { message: message });
        messageInput.value = '';
    }
});

socket.on('new_message', (data) => {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message';
    messageDiv.innerHTML = `
        <div class="message-header">
            <span>${data.username}</span>
            <span>${data.timestamp}</span>
        </div>
        <div class="message-content">
            ${data.message}
        </div>
    `;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

// Auto-scroll to bottom on page load
messagesDiv.scrollTop = messagesDiv.scrollHeight;
</script>
{% endblock %}
